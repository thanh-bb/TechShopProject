<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>TechShop.Web</title>
    <base href="/" />
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="css/app.css" rel="stylesheet" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link href="TechShop.Web.styles.css" rel="stylesheet" />

   



    <!--link c·ªßa map-->
    <link rel="stylesheet" href="./DiaLy/css/leaflet.css">
    <link rel="stylesheet" href="./DiaLy/css/map_style.css">

</head>

<body>
    <div id="app">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%" />
            <circle r="40%" cx="50%" cy="50%" />
        </svg>
        <div class="loading-progress-text"></div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">üóô</a>
    </div>

    <script src="_framework/blazor.webassembly.js"></script>

    <!--<script src="_framework/blazor.server.js"></script>-->
   
    <!--ShoppingCart-->
    <script src="/assets/js/ShoppingCartFunction.js"></script>


    <script src="./DiaLy/js/leaflet.js"></script>
    <script>
        function initialize() {
            //Khai b√°o ƒë·ªëi t∆∞·ª£ng ch√≠nh ch·ª©a b·∫£n ƒë·ªì g·∫Øn v√†o th·∫ª div t√™n "map"
            var mapObject = L.map("map", { center: [10.030249, 105.772097], zoom: 17 });
            //ho·∫∑c: var mapObject = L.map('map').setView([10.030249, 105.772097], 17);

            //B·∫£n ƒë·ªì n·ªÅn d·∫°ng Raster
            L.tileLayer(
                "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
                {
                    attribution: '&copy; <a href="http://' +
                        'www.openstreetmap.org/copyright">OpenStreetMap</a>'
                }
            ).addTo(mapObject);

            var layerObject = L.layerGroup().addTo(mapObject);

            var combobox = L.control({ position: "topleft" });
            combobox.onAdd = function (map) {
                var div = L.DomUtil.create("div", "");
                div.innerHTML = '<select id="combobox"></select>';
                return div;
            };
            combobox.addTo(mapObject);

            var urlJSON = "https://localhost:44368/api/Map/GetData";
            var sql = "?q=ALL";
            $.getJSON(urlJSON + sql, function (data) {
                var menu = $("#combobox");
                menu.append("<option data-id='ALL'>T·∫•t c·∫£</option>");
                $.each(data.features, function (key, value) {
                    menu.append("<option data-id=" + value.id + ">" + value.properties.name + "</option>");
                });

                var lineStyle = { color: "blue", weight: 4 };
                var polygonStyle = { color: "red", fillColor: "yellow", weight: 4 };
                L.geoJSON(data, {
                    style: function (feature) {
                        switch (feature.geometry.type) {
                            case 'LineString': return lineStyle;
                            case 'Polygon': return polygonStyle;
                        }
                    },
                    onEachFeature: function (feature, layer) {
                        if (feature.properties && feature.properties.name) {
                            layer.bindPopup("<i>" + feature.properties.name + "</i>");
                        }
                    }
                }).addTo(layerObject);
            });

            $("#combobox").on("change", function () {
                var valueSelected = $("#combobox option:selected").data("id");
                if (valueSelected == "ALL") {
                    sql = "?q=ALL";
                } else {
                    sql = "?q=" + valueSelected;
                }

                $.getJSON(urlJSON + sql, function (data) {
                    layerObject.clearLayers();

                    var lineStyle = { color: "blue", weight: 4 };
                    var polygonStyle = { color: "red", fillColor: "yellow", weight: 4 };
                    L.geoJSON(data, {
                        style: function (feature) {
                            switch (feature.geometry.type) {
                                case 'LineString': return lineStyle;
                                case 'Polygon': return polygonStyle;
                            }
                        },
                        onEachFeature: function (feature, layer) {
                            if (feature.properties && feature.properties.name) {
                                layer.bindPopup("<i>" + feature.properties.name + "</i>");
                            }
                        }
                    }).addTo(layerObject);
                })
            });
        }

    </script>


</body>

</html>
