@page "/login"
@using TechShop.Models.Dtos;
@using TechShop.Web.Services.Contracts;

@inject NavigationManager NavigationManager;
@inject IAuthService AuthService;

<link rel="stylesheet" type="text/css" href="./login/css/main.css" />
<link rel="stylesheet" type="text/css" href="./login/css/util.css" />
<link rel="stylesheet" type="text/css" href="./login/css/style.css" />


@if (ShowErrors)
{
    <div class="alert alert-danger">
        <p>@Error</p>
    </div>
}

<div class="limiter">
    <div class="container-login100" style="background-image: url('');">
        <div class="wrap-login100 p-l-55 p-r-55 p-t-65 p-b-54">

            <form class="login100-form validate-form">
                <span class="login100-form-title p-b-49">
                    Đăng Nhập 
                </span>
                @if (ShowErrors)
                {
                    <div class="alert alert-danger">
                        <p>@Error</p>
                    </div>
                }
                <EditForm Model="LoginModel" OnValidSubmit="HandleLogin">
                    <DataAnnotationsValidator></DataAnnotationsValidator>
                  @*   <ValidationSummary></ValidationSummary> *@

                    <div class="formm-group wrap-input100 validate-input m-b-23">
                        <label for="username" class="label-input100">Username</label>
                        <InputText id="username" class="form-control" @bind-Value="LoginModel.UserName"></InputText>
                        <ValidationMessage For="()=>LoginModel.UserName"></ValidationMessage>

                    </div>

                    <div class="formm-group wrap-input100 validate-input m-b-23">
                        <label for="password">Password</label>
                        <InputText id="password" class="form-control" @bind-Value="LoginModel.PasswordHash"></InputText>
                        <ValidationMessage For="()=>LoginModel.PasswordHash"></ValidationMessage>

                    </div>

                    <div class="container-login100-form-btn">
                        <div class="wrap-login100-form-btn">
                            <div class="login100-form-bgbtn"></div>
                            <button class="login100-form-btn">
                                Login
                            </button>
                        </div>
                    </div>
                </EditForm>
            </form>
        </div>
    </div>

</div>


<script src="./login/js/main.js"></script>

@code {
    private bool ShowErrors;
    private string Error = "";
    private LoginRequest LoginModel = new LoginRequest();

    private async Task HandleLogin()
    {
        ShowErrors = false;

        var result = await AuthService.Login(LoginModel);
        if (result.Successful)
        {
            NavigationManager.NavigateTo("/");
        }
        else
        {
            ShowErrors = true;
            Error = result.Error;
        }
    }
}